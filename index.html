<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; padding: 20px; }
      .box { background: #eef; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
    </style>
  </head>
  <body>
    <h2>Add Patient</h2>
    <form id="addPatientForm">
      <input type="text" id="name" placeholder="Full Name" required><br><br>
      <input type="text" id="number" placeholder="Phone Number" required><br><br>
      <input type="date" id="recallDate" required><br><br>
      <button type="submit">Add</button>
    </form>
    <p id="addStatus"></p>

    <h2>Upcoming Recalls (Next 7 Days)</h2>
    <div id="recallList">Loading...</div>

    <script>
      document.getElementById("addPatientForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const data = {
          name: document.getElementById("name").value,
          number: document.getElementById("number").value,
          recallDate: document.getElementById("recallDate").value
        };
        google.script.run
          .withSuccessHandler(function (msg) {
            document.getElementById("addStatus").textContent = msg;
            document.getElementById("addPatientForm").reset();
            loadRecalls();
          })
          .addPatient(data);
      });

      function loadRecalls() {
        document.getElementById("recallList").innerHTML = "Loading...";
        google.script.run.withSuccessHandler(function (data) {
          if (!data.length) {
            document.getElementById("recallList").innerHTML = "No upcoming recalls.";
            return;
          }
          let html = "";
          data.forEach(function (p) {
            html += `<div class="box"><strong>${p.name}</strong> â€” ${p.number}<br>ðŸ“… ${new Date(p.recallDate).toLocaleDateString()}</div>`;
          });
          document.getElementById("recallList").innerHTML = html;
        }).getUpcomingRecalls();
      }

      loadRecalls();
    </script>
  </body>
</html>
